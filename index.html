<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Match App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#111;
  color:#fff;
}
#login,#perfil{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  width:100%;
  max-width:400px;
  background:#000;
  padding:20px;
  border-radius:16px;
  text-align:center;
}
button,input,select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
}
button{
  background:#ff0055;
  color:#fff;
  font-weight:bold;
}
input,select{
  background:#111;
  color:#fff;
  border:1px solid #333;
}
img{
  width:120px;
  height:120px;
  border-radius:50%;
  object-fit:cover;
  margin:10px auto;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { 
  getAuth, 
  GoogleAuthProvider, 
  signInWithPopup, 
  onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { 
  getFirestore, 
  doc, 
  setDoc, 
  getDoc 
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBszwdqJLY0GiPNlxh37_wNpSsIm0y9N0c",
  authDomain: "chat-1adf8.firebaseapp.com",
  projectId: "chat-1adf8",
  storageBucket: "chat-1adf8.appspot.com",
  messagingSenderId: "466107819820",
  appId: "1:466107819820:web:e297a7c513db3d96696e89"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

window.loginGoogle = async ()=>{
  await signInWithPopup(auth,provider);
};

onAuthStateChanged(auth, async user=>{
  if(!user) return;
  
  document.getElementById("login").style.display="none";
  document.getElementById("perfil").style.display="flex";

  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);

  if(!snap.exists()){
    await setDoc(ref,{
      uid:user.uid,
      nombre:user.displayName,
      foto:user.photoURL,
      email:user.email,
      edad:"",
      ciudad:"",
      genero:"",
      creado:Date.now()
    });
  }

  document.getElementById("foto").src = user.photoURL;
  document.getElementById("nombre").innerText = user.displayName;
});

window.guardarPerfil = async ()=>{
  const user = auth.currentUser;
  if(!user) return;

  await setDoc(doc(db,"users",user.uid),{
    edad:document.getElementById("edad").value,
    ciudad:document.getElementById("ciudad").value,
    genero:document.getElementById("genero").value
  },{merge:true});

  alert("Perfil guardado ✔");
};
</script>
</head>

<body>

<div id="login">
  <div class="card">
    <h2>Match App</h2>
    <button onclick="loginGoogle()">Entrar con Google</button>
  </div>
</div>

<div id="perfil" style="display:none">
  <div class="card">
    <img id="foto">
    <h3 id="nombre"></h3>

    <input id="edad" placeholder="Edad">
    <input id="ciudad" placeholder="Ciudad">

    <select id="genero">
      <option value="">Género</option>
      <option value="mujer">Mujer</option>
      <option value="hombre">Hombre</option>
    </select>

    <button onclick="guardarPerfil()">Guardar perfil</button>
  </div>
</div>

</body>
</html>
