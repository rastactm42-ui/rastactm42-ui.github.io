<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat Firebase</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#000,#1a0033,#000);
  color:#fff;
}
.container{
  max-width:420px;
  margin:40px auto;
  background:rgba(0,0,0,.9);
  padding:20px;
  border-radius:16px;
  box-shadow:0 0 25px #ff00ff;
}
h2{text-align:center;color:#ff00ff}
input,button{
  width:100%;padding:12px;margin:6px 0;
  border:none;border-radius:8px;
}
input{background:#111;color:#fff;border:1px solid #333}
button{
  background:linear-gradient(90deg,#ff00ff,#ff0066);
  color:#fff;font-weight:bold;cursor:pointer;
}
#chat{display:none}
#mensajes{
  height:220px;overflow-y:auto;
  background:#000;border:1px solid #333;
  padding:10px;margin-bottom:8px;
}
.mensaje{margin-bottom:6px}
</style>
</head>

<body>

<div class="container" id="login">
  <h2>ðŸ”¥ REGISTRO / LOGIN ðŸ”¥</h2>
  <input id="email" placeholder="Correo electrÃ³nico">
  <input id="password" type="password" placeholder="ContraseÃ±a">
  <button onclick="registrar()">REGISTRARSE</button>
  <button onclick="login()">ENTRAR</button>
</div>

<div class="container" id="chat">
  <h2>ðŸ’¬ CHAT</h2>
  ðŸ‘¤ <span id="infoUser"></span><br><br>

  <div id="mensajes"></div>

  <input id="texto" placeholder="Escribe un mensaje">
  <button onclick="enviar()">ENVIAR</button>
  <button onclick="salir()">SALIR</button>
</div>

<!-- ðŸ”¥ FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* CONFIG FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBszwdqJLY0GiPNlxh37_wNpSsIm0y9N0c",
  authDomain: "chat-1adf8.firebaseapp.com",
  projectId: "chat-1adf8",
  storageBucket: "chat-1adf8.firebasestorage.app",
  messagingSenderId: "466107819820",
  appId: "1:466107819820:web:e297a7c513db3d96696e89"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ELEMENTOS */
const emailEl = document.getElementById("email");
const passEl = document.getElementById("password");
const loginDiv = document.getElementById("login");
const chatDiv = document.getElementById("chat");
const infoUser = document.getElementById("infoUser");
const texto = document.getElementById("texto");
const mensajes = document.getElementById("mensajes");

/* REGISTRO */
function registrar(){
  auth.createUserWithEmailAndPassword(emailEl.value, passEl.value)
  .then(()=>alert("Usuario creado âœ”ï¸"))
  .catch(e=>alert(e.message));
}

/* LOGIN */
function login(){
  auth.signInWithEmailAndPassword(emailEl.value, passEl.value)
  .catch(e=>alert(e.message));
}

/* SESIÃ“N */
auth.onAuthStateChanged(user=>{
  if(user){
    loginDiv.style.display="none";
    chatDiv.style.display="block";
    infoUser.innerText=user.email;
  }
});

/* CHAT */
function enviar(){
  if(!texto.value) return;
  db.collection("mensajes").add({
    user: auth.currentUser.email,
    texto: texto.value,
    time: Date.now()
  });
  texto.value="";
}

db.collection("mensajes").orderBy("time")
.onSnapshot(snap=>{
  mensajes.innerHTML="";
  snap.forEach(doc=>{
    const d=document.createElement("div");
    d.className="mensaje";
    d.textContent=doc.data().user+": "+doc.data().texto;
    mensajes.appendChild(d);
  });
});

/* SALIR */
function salir(){
  auth.signOut();
  location.reload();
}
</script>

</body>
</html>
