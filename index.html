<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Match</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#000;
  color:#fff;
}
#login,#app{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  width:100%;
  max-width:420px;
  text-align:center;
}
button{
  padding:14px;
  width:100%;
  border:none;
  border-radius:30px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}
#perfil{
  position:relative;
  width:100%;
  height:100vh;
}
#foto{
  width:100%;
  height:100%;
  object-fit:cover;
}
.info{
  position:absolute;
  bottom:90px;
  left:20px;
  text-shadow:0 0 10px #000;
}
.acciones{
  position:absolute;
  bottom:20px;
  width:100%;
  display:flex;
  justify-content:space-around;
}
.like{background:#00e676;color:#000}
.nope{background:#ff1744}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, setDoc, getDoc } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBszwdqJLY0GiPNlxh37_wNpSsIm0y9N0c",
  authDomain: "chat-1adf8.firebaseapp.com",
  projectId: "chat-1adf8",
  storageBucket: "chat-1adf8.appspot.com",
  messagingSenderId: "466107819820",
  appId: "1:466107819820:web:e297a7c513db3d96696e89"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

let usuarios = [];
let index = 0;
let yo = null;

window.loginGoogle = async()=>{
  await signInWithPopup(auth,provider);
};

onAuthStateChanged(auth, async user=>{
  if(!user) return;
  yo = user;
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="block";

  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);

  if(!snap.exists()){
    await setDoc(ref,{
      uid:user.uid,
      nombre:user.displayName,
      foto:user.photoURL
    });
  }

  cargarUsuarios();
});

async function cargarUsuarios(){
  const snap = await getDocs(collection(db,"users"));
  usuarios = snap.docs
    .map(d=>d.data())
    .filter(u=>u.uid!==yo.uid);

  mostrar();
}

function mostrar(){
  if(index>=usuarios.length){
    alert("No hay m√°s perfiles");
    return;
  }
  const u = usuarios[index];
  document.getElementById("foto").src = u.foto;
  document.getElementById("nombre").innerText = u.nombre;
}

window.like = async()=>{
  const u = usuarios[index];
  await setDoc(doc(db,"likes",yo.uid+"_"+u.uid),{
    de:yo.uid,
    a:u.uid
  });

  const match = await getDoc(doc(db,"likes",u.uid+"_"+yo.uid));
  if(match.exists()){
    alert("üî• MATCH con "+u.nombre);
  }

  index++;
  mostrar();
};

window.nope = ()=>{
  index++;
  mostrar();
};
</script>
</head>

<body>

<div id="login">
  <div class="card">
    <h2>Match</h2>
    <button onclick="loginGoogle()">Entrar con Google</button>
  </div>
</div>

<div id="app" style="display:none">
  <div id="perfil">
    <img id="foto">
    <div class="info">
      <h2 id="nombre"></h2>
    </div>
    <div class="acciones">
      <button class="nope" onclick="nope()">‚ùå</button>
      <button class="like" onclick="like()">‚ù§Ô∏è</button>
    </div>
  </div>
</div>

</body>
</html>
