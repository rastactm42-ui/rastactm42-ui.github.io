<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHAT</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#000;color:#fff;height:100vh;overflow:hidden}

#app{display:none;flex-direction:column;height:100vh}
header{text-align:center;padding:14px;font-size:20px;border-bottom:1px solid #222}

nav{
  height:60px;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #222;
}
nav button{
  background:none;border:none;color:#888;font-size:14px
}
nav button.active{color:#ff0066;font-weight:bold}

section{flex:1;display:none;justify-content:center;align-items:center}

#login{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:15px;
}
#login button{
  padding:14px 25px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ff0066;
  color:#fff;
}

.card{
  width:90%;
  max-width:380px;
  background:#111;
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 20px rgba(255,0,120,.4);
  text-align:center;
}
.card img{
  width:120px;
  height:120px;
  border-radius:50%;
  object-fit:cover;
  margin-bottom:10px;
}
.card input{
  width:100%;
  padding:10px;
  margin:6px 0;
  background:#000;
  border:1px solid #333;
  color:#fff;
  border-radius:8px;
}
.card button{
  width:100%;
  padding:12px;
  background:#ff0066;
  border:none;
  border-radius:8px;
  color:#fff;
  margin-top:10px;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  onAuthStateChanged,
  signOut,
  updateProfile
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyBszwdqJLY0GiPNlxh37_wNpSsIm0y9N0c",
  authDomain:"chat-1adf8.firebaseapp.com",
  projectId:"chat-1adf8",
  storageBucket:"chat-1adf8.appspot.com",
  messagingSenderId:"466107819820",
  appId:"1:466107819820:web:e297a7c513db3d96696e89"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const provider=new GoogleAuthProvider();

/* LOGIN */
window.loginGoogle=async()=>{
  await signInWithPopup(auth,provider);
};

/* SESIÓN */
onAuthStateChanged(auth,async user=>{
  if(!user) return;
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="flex";
  abrir("perfil");

  const ref=doc(db,"usuarios",user.uid);
  const snap=await getDoc(ref);

  if(!snap.exists()){
    await setDoc(ref,{
      uid:user.uid,
      nick:user.displayName||"",
      edad:"",
      ciudad:"",
      foto:user.photoURL
    });
  }

  cargarPerfil();
});

/* PERFIL */
async function cargarPerfil(){
  const user=auth.currentUser;
  const ref=doc(db,"usuarios",user.uid);
  const data=(await getDoc(ref)).data();

  document.getElementById("foto").src=data.foto;
  document.getElementById("nick").value=data.nick;
  document.getElementById("edad").value=data.edad;
  document.getElementById("ciudad").value=data.ciudad;
}

window.guardarPerfil=async()=>{
  const user=auth.currentUser;
  await setDoc(doc(db,"usuarios",user.uid),{
    uid:user.uid,
    nick:nick.value,
    edad:edad.value,
    ciudad:ciudad.value,
    foto:user.photoURL
  });
  await updateProfile(user,{displayName:nick.value});
  alert("Perfil guardado");
};

/* NAVEGACIÓN */
window.abrir=(id)=>{
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="flex";
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById("btn-"+id).classList.add("active");
};
</script>
</head>

<body>

<div id="login">
  <h2>CHAT</h2>
  <button onclick="loginGoogle()">Entrar con Google</button>
</div>

<div id="app">

<header>CHAT</header>

<section id="descubrir">
  <h3>Descubrir (próximo paso)</h3>
</section>

<section id="chat">
  <h3>Chat (próximo paso)</h3>
</section>

<section id="perfil">
  <div class="card">
    <img id="foto">
    <input id="nick" placeholder="Nick">
    <input id="edad" placeholder="Edad">
    <input id="ciudad" placeholder="Ciudad">
    <button onclick="guardarPerfil()">Guardar</button>
  </div>
</section>

<section id="config">
  <button onclick="signOut()">Salir</button>
</section>

<nav>
  <button id="btn-descubrir" onclick="abrir('descubrir')">Descubrir</button>
  <button id="btn-chat" onclick="abrir('chat')">Chat</button>
  <button id="btn-perfil" onclick="abrir('perfil')" class="active">Perfil</button>
  <button id="btn-config" onclick="abrir('config')">Config</button>
</nav>

</div>

</body>
</html>
