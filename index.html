<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#000,#1a0033,#000);
  color:#fff;
}
.container{
  max-width:420px;
  margin:40px auto;
  background:rgba(0,0,0,.9);
  padding:20px;
  border-radius:16px;
  box-shadow:0 0 25px #ff00ff;
}
h2{text-align:center;color:#ff00ff}
input,select,button{
  width:100%;padding:12px;margin:6px 0;
  border:none;border-radius:8px;
}
input,select{background:#111;color:#fff;border:1px solid #333}
button{
  background:linear-gradient(90deg,#ff00ff,#ff0066);
  color:#fff;font-weight:bold;cursor:pointer;
}
#chat{display:none}
#mensajes{
  height:220px;overflow-y:auto;
  background:#000;border:1px solid #333;
  padding:10px;margin-bottom:8px;
}
.mensaje{margin-bottom:6px}
.hombre{color:#4da6ff}
.mujer{color:#ff66cc}
.regalo{color:#ffd700;font-weight:bold}
</style>
</head>

<body>

<div class="container" id="login">
  <h2>游댠 REGISTRO 游댠</h2>
  <input id="email" placeholder="Correo electr칩nico">
  <input id="password" type="password" placeholder="Contrase침a">

  <select id="tipo">
    <option value="">Selecciona</option>
    <option value="hombre">游녿 Hombre</option>
    <option value="mujer">游놀 Mujer</option>
  </select>

  <button onclick="registrar()">REGISTRARSE</button>
  <button onclick="loginUser()">ENTRAR</button>
</div>

<div class="container" id="chat">
  <h2>游눫 CHAT</h2>

  游녻 <span id="infoUser"></span><br>
  游눯 Monedas: <span id="monedas">0</span><br><br>

  <div id="mensajes"></div>

  <input id="texto" placeholder="Mensaje">
  <button onclick="enviar()">ENVIAR</button>
  <button onclick="regalo()">游꾸 Enviar regalo (10)</button>
  <button onclick="salir()">SALIR</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBszwdqJLY0GiPNlxh37_wNpSsIm0y9N0c",
  authDomain: "chat-1adf8.firebaseapp.com",
  projectId: "chat-1adf8",
  storageBucket: "chat-1adf8.firebasestorage.app",
  messagingSenderId: "466107819820",
  appId: "1:466107819820:web:e297a7c513db3d96696e89"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const email = document.getElementById("email");
const password = document.getElementById("password");
const tipoEl = document.getElementById("tipo");
const infoUser = document.getElementById("infoUser");
const monedasEl = document.getElementById("monedas");
const texto = document.getElementById("texto");
const mensajes = document.getElementById("mensajes");

let usuario=null;
let tipo="";
let monedas=0;

/* REGISTRO */
function registrar(){
  if(!tipoEl.value) return alert("Selecciona Hombre o Mujer");

  auth.createUserWithEmailAndPassword(email.value, password.value)
  .then(cred=>{
    return db.collection("usuarios").doc(cred.user.uid).set({
      email: email.value,
      tipo: tipoEl.value,
      monedas: tipoEl.value==="hombre" ? 100 : 0
    });
  })
  .then(()=>alert("Usuario creado"))
  .catch(e=>alert(e.message));
}

/* LOGIN */
function loginUser(){
  auth.signInWithEmailAndPassword(email.value, password.value)
  .catch(e=>alert(e.message));
}

/* SESI칍N */
auth.onAuthStateChanged(u=>{
  if(!u) return;
  usuario=u;

  db.collection("usuarios").doc(u.uid).get().then(doc=>{
    const d=doc.data();
    tipo=d.tipo;
    monedas=d.monedas;
    infoUser.innerText=d.email+" ("+tipo+")";
    monedasEl.innerText=monedas;

    document.getElementById("login").style.display="none";
    document.getElementById("chat").style.display="block";
  });
});

/* CHAT */
function enviar(){
  if(!texto.value) return;
  db.collection("mensajes").add({
    user: usuario.email,
    tipo,
    texto: texto.value,
    time: Date.now()
  });
  texto.value="";
}

db.collection("mensajes").orderBy("time")
.onSnapshot(snap=>{
  mensajes.innerHTML="";
  snap.forEach(doc=>{
    const d=document.createElement("div");
    d.className="mensaje "+doc.data().tipo;
    d.textContent=doc.data().user+": "+doc.data().texto;
    mensajes.appendChild(d);
  });
});

/* REGALO */
function regalo(){
  if(tipo!=="hombre") return alert("Solo hombres env칤an regalos");
  if(monedas<10) return alert("No tienes monedas");

  monedas-=10;
  monedasEl.innerText=monedas;
  db.collection("usuarios").doc(usuario.uid).update({monedas});

  db.collection("usuarios").where("tipo","==","mujer").get()
  .then(q=>{
    q.forEach(doc=>{
      db.collection("usuarios").doc(doc.id)
      .update({monedas: firebase.firestore.FieldValue.increment(10)});
    });
  });

  db.collection("mensajes").add({
    texto:"游꾸 Regalo enviado (+10 a chicas)",
    tipo:"regalo",
    time:Date.now()
  });
}

/* SALIR */
function salir(){
  auth.signOut();
  location.reload();
}
</script>

</body>
</html>
