<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Citas</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#000;color:#fff;height:100vh}

#login,#perfil,#app{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:16px;
}

#app{display:none}
#perfil{display:none}

button{
  padding:14px 28px;
  background:#ff0066;
  border:none;
  border-radius:10px;
  color:#fff;
  font-size:16px;
}

.card{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
}

.card img{
  width:100%;
  max-width:420px;
  aspect-ratio: 3 / 4;
  object-fit: cover;
  border-radius:20px;
  background:#111;
  display:block;
}

.actions{
  display:flex;
  justify-content:space-around;
  width:100%;
  padding:14px;
}

.actions button{
  width:60px;
  height:60px;
  border-radius:50%;
  font-size:24px;
}

input[type=file]{
  color:#fff;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBszwdqJLY0GiPNlxh37_wNpSsIm0y9N0c",
  authDomain: "chat-1adf8.firebaseapp.com",
  projectId: "chat-1adf8",
  storageBucket: "chat-1adf8.appspot.com",
  messagingSenderId: "466107819820",
  appId: "1:466107819820:web:e297a7c513db3d96696e89"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);
const provider = new GoogleAuthProvider();

let perfiles=[],pos=0;

window.loginGoogle=()=>signInWithPopup(auth,provider);

onAuthStateChanged(auth, async user=>{
  if(!user) return;

  const refUser=doc(db,"usuarios",user.uid);
  const snap=await getDoc(refUser);

  if(!snap.exists()){
    document.getElementById("login").style.display="none";
    document.getElementById("perfil").style.display="flex";
    return;
  }

  cargarPerfiles(user.uid);
});

window.subirFoto=async()=>{
  const file=document.getElementById("fotoInput").files[0];
  if(!file) return alert("Selecciona una foto");

  const user=auth.currentUser;
  const storageRef=ref(storage,`fotos/${user.uid}.jpg`);
  await uploadBytes(storageRef,file);
  const url=await getDownloadURL(storageRef);

  await setDoc(doc(db,"usuarios",user.uid),{
    uid:user.uid,
    nick:user.displayName||"Usuario",
    foto:url
  });

  location.reload();
};

async function cargarPerfiles(uid){
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="flex";

  const all=await getDocs(collection(db,"usuarios"));
  perfiles=[];
  all.forEach(d=>{
    if(d.id!==uid) perfiles.push(d.data());
  });
  mostrar();
}

function mostrar(){
  if(!perfiles.length) return;
  document.getElementById("foto").src=perfiles[pos].foto;
  document.getElementById("nombre").innerText=perfiles[pos].nick;
}

window.like=()=>{pos=(pos+1)%perfiles.length;mostrar();}
window.dislike=()=>{pos=(pos+1)%perfiles.length;mostrar();}
</script>
</head>

<body>

<div id="login">
  <h2>App de Citas</h2>
  <button onclick="loginGoogle()">Entrar con Google</button>
</div>

<div id="perfil">
  <h3>Sube tu foto</h3>
  <input type="file" id="fotoInput" accept="image/*">
  <button onclick="subirFoto()">Continuar</button>
</div>

<div id="app">
  <h3 id="nombre"></h3>
  <div class="card">
    <img id="foto">
  </div>
  <div class="actions">
    <button onclick="dislike()">❌</button>
    <button onclick="like()">❤️</button>
  </div>
</div>

</body>
</html>
